var e,r;"function"==typeof(e=globalThis.define)&&(r=e,e=null),(()=>{globalThis.browser?.tabs||globalThis.chrome?.tabs;var e,r,t=()=>{let e=globalThis.browser?.runtime||globalThis.chrome?.runtime;if(!e)throw Error("Extension runtime is not available");return e},a=(e,r)=>!r.__internal&&e.source===globalThis.window&&e.data.name===r.name&&(void 0===r.relayId||e.data.relayId===r.relayId),n=async e=>t().sendMessage(e.extensionId??null,e);(e=r||(r={})).ERROR="error",e.WARN="warn",e.INFO="info",e.DEBUG="debug";let s=r.INFO,o=()=>!1,i=()=>o()?s:r.DEBUG,l=e=>{let t=i();switch(t){case r.ERROR:return e===r.ERROR;case r.WARN:return e===r.ERROR||e===r.WARN;case r.INFO:return e===r.ERROR||e===r.WARN||e===r.INFO;case r.DEBUG:return!0;default:return!1}};class c{constructor(e="app"){this.context=e}formatMessage(e){return`[${this.context}] ${e}`}normalizeArgs(e){return e.map(e=>{if(e instanceof Error){let r={name:e.name,message:e.message,stack:e.stack},{cause:t}=e;for(let a of(void 0!==t&&(r.cause=t),Object.getOwnPropertyNames(e))){let t=e[a];a in r||void 0===t||(r[a]=t)}try{return JSON.stringify(r,null,2)}catch(e){return String(r)}}if("object"==typeof e&&null!==e&&"[object Object]"===Object.prototype.toString.call(e))try{return JSON.stringify(e,null,2)}catch(r){return String(e)}return e})}error(e,...t){l(r.ERROR)&&console.error(this.formatMessage(e),...this.normalizeArgs(t))}warn(e,...t){l(r.WARN)&&console.warn(this.formatMessage(e),...this.normalizeArgs(t))}info(e,...t){l(r.INFO)&&console.info(this.formatMessage(e),...this.normalizeArgs(t))}debug(e,...t){l(r.DEBUG)&&console.debug(this.formatMessage(e),...this.normalizeArgs(t))}log(e,...r){this.info(e,...r)}}let g=(e="app")=>new c(e);g();let d=g("event-cs");((e,r,t=globalThis.window)=>{let n=async n=>{if(a(n,e)&&!n.data.relayed){let a={name:e.name,relayId:e.relayId,body:n.data.body},s=await r?.(a);t.postMessage({name:e.name,relayId:e.relayId,instanceId:n.data.instanceId,body:s,relayed:!0},{targetOrigin:e.targetOrigin||"/"})}};return t.addEventListener("message",n),()=>t.removeEventListener("message",n)})({name:"event"},n),d.info("Content script relay bridge established")})(),globalThis.define=r;