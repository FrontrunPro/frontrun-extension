var e,t;"function"==typeof(e=globalThis.define)&&(t=e,e=null),(()=>{function e(e,t,r,s){Object.defineProperty(e,t,{get:r,set:s,enumerable:!0,configurable:!0})}var t,r,s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},n={},i={},a=s.parcelRequiref356;null==a&&((a=function(e){if(e in n)return n[e].exports;if(e in i){var t=i[e];delete i[e];var r={id:e,exports:{}};return n[e]=r,t.call(r.exports,r,r.exports),r.exports}var s=Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}).register=function(e,t){i[e]=t},s.parcelRequiref356=a),a.register("aKuo0",function(t,r){e(t.exports,"LogBuffer",()=>s),e(t.exports,"logBuffer",()=>n);class s{constructor(e=1e3){this.head=0,this.count=0,this.maxSize=e,this.buffer=Array(e)}push(e){let t=(this.head+this.count)%this.maxSize;this.count<this.maxSize?this.count++:this.head=(this.head+1)%this.maxSize,this.buffer[t]=e}getAll(){let e=[];for(let t=0;t<this.count;t++){let r=(this.head+t)%this.maxSize,s=this.buffer[r];s&&e.push(s)}return e}size(){return this.count}clear(){this.buffer=Array(this.maxSize),this.head=0,this.count=0}clearOldest(e){if(!(e<=0)){if(e>=this.count){this.clear();return}for(let t=0;t<e;t++){let e=(this.head+t)%this.maxSize;this.buffer[e]=void 0}this.head=(this.head+e)%this.maxSize,this.count-=e}}isEmpty(){return 0===this.count}isFull(){return this.count>=this.maxSize}}let n=new s(1e3)}),globalThis.browser?.tabs||globalThis.chrome?.tabs;var o=()=>{let e=globalThis.browser?.runtime||globalThis.chrome?.runtime;if(!e)throw Error("Extension runtime is not available");return e},l=(e,t)=>!t.__internal&&e.source===globalThis.window&&e.data.name===t.name&&(void 0===t.relayId||e.data.relayId===t.relayId),u=async e=>o().sendMessage(e.extensionId??null,e);let f=null,h=()=>{if(null===f&&p()){let{logBuffer:e}=a("aKuo0");f=e}return f};(t=r||(r={})).ERROR="error",t.WARN="warn",t.INFO="info",t.DEBUG="debug";let c=()=>{if("undefined"!=typeof window)return!1;let e=globalThis;return!!(e.registration&&e.clients)},d=r.INFO,g=()=>!1,m=()=>g()?d:r.DEBUG,b=e=>{let t=m();switch(t){case r.ERROR:return e===r.ERROR;case r.WARN:return e===r.ERROR||e===r.WARN;case r.INFO:return e===r.ERROR||e===r.WARN||e===r.INFO;case r.DEBUG:return!0;default:return!1}},y=null,p=()=>(null===y&&(y=c()),y);class O{constructor(e="app"){this.context=e}formatMessage(e){return`[${this.context}] ${e}`}bufferLog(e,t,r){let s={timestamp:Date.now(),level:e,context:this.context,message:t,args:r.map(e=>{if(e instanceof Error)return{__type:"Error",name:e.name,message:e.message,stack:e.stack,cause:e.cause};if("object"==typeof e&&null!==e)try{return JSON.parse(JSON.stringify(e))}catch{return String(e)}return e})};if(p()){let e=h();e&&e.push(s)}else u({name:"forwardLog",body:{entry:s}}).catch(()=>{})}normalizeArgs(e){return e.map(e=>{if(e instanceof Error){let t={name:e.name,message:e.message,stack:e.stack},{cause:r}=e;for(let s of(void 0!==r&&(t.cause=r),Object.getOwnPropertyNames(e))){let r=e[s];s in t||void 0===r||(t[s]=r)}try{return JSON.stringify(t,null,2)}catch(e){return String(t)}}if("object"==typeof e&&null!==e&&"[object Object]"===Object.prototype.toString.call(e))try{return JSON.stringify(e,null,2)}catch(t){return String(e)}return e})}error(e,...t){this.bufferLog("error",e,t),b(r.ERROR)&&console.error(this.formatMessage(e),...this.normalizeArgs(t))}warn(e,...t){this.bufferLog("warn",e,t),b(r.WARN)&&console.warn(this.formatMessage(e),...this.normalizeArgs(t))}info(e,...t){this.bufferLog("info",e,t),b(r.INFO)&&console.info(this.formatMessage(e),...this.normalizeArgs(t))}debug(e,...t){this.bufferLog("debug",e,t),b(r.DEBUG)&&console.debug(this.formatMessage(e),...this.normalizeArgs(t))}log(e,...t){this.info(e,...t)}}let w=(e="app")=>new O(e);w();let R=w("event-cs");((e,t,r=globalThis.window)=>{let s=async s=>{if(l(s,e)&&!s.data.relayed){let n={name:e.name,relayId:e.relayId,body:s.data.body},i=await t?.(n);r.postMessage({name:e.name,relayId:e.relayId,instanceId:s.data.instanceId,body:i,relayed:!0},{targetOrigin:e.targetOrigin||"/"})}};return r.addEventListener("message",s),()=>r.removeEventListener("message",s)})({name:"event"},u),R.info("Content script relay bridge established")})(),globalThis.define=t;